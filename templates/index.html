<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø±Ø¨ÛŒØªØ§Ø¬Ø±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://v1.fontapi.ir/css/Vazir" rel="stylesheet">
    <style>
        body {
            direction: rtl;
            text-align: right;
            font-family: 'Vazir', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark-theme {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .dark-theme .price-table, .dark-theme .card, .dark-theme .results-table, .dark-theme .price-diff-box {
            background-color: #2c2c2c !important;
            color: #e0e0e0;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: #e0e0e0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-radius: 0 0 10px 10px;
        }
        .dark-theme .header {
            background: #2a2a2a;
        }
        .theme-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .theme-toggle:hover {
            transform: scale(1.2);
        }
        .price-table {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: #fff;
            width: 100%;
            border-collapse: collapse;
        }
        .dark-theme .price-table {
            background: #2c2c2c !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .price-table th {
            background-color: #007bff;
            color: white;
            padding: 10px;
        }
        .price-table td {
            vertical-align: middle;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            background: #fff;
            color: #333;
        }
        .dark-theme .price-table td {
            border-bottom: 1px solid #444;
            background: #2c2c2c !important;
            color: #e0e0e0 !important;
        }
        .price-table tbody, .price-table tr {
            background: #fff;
        }
        .dark-theme .price-table tbody, .dark-theme .price-table tr {
            background: #2c2c2c !important;
        }
        .price-table tr:hover {
            background-color: #f1f1f1;
        }
        .dark-theme .price-table tr:hover {
            background-color: #444 !important;
        }
        .price-table tr:last-child td {
            border-bottom: none;
        }
        .trade-column {
            text-align: center;
            width: 100px !important;
            min-width: 100px;
            max-width: 100px;
            padding: 5px !important;
        }
        .trade-btn {
            display: inline-block;
            width: 80px;
            padding: 4px 6px;
            background-color: #007bff;
            color: #fff !important;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: background-color 0.3s;
        }
        .dark-theme .trade-btn {
            background-color: #1a73e8;
        }
        .trade-btn:hover {
            background-color: #0056b3;
            color: #fff !important;
        }
        .dark-theme .trade-btn:hover {
            background-color: #4285f4;
        }
        .chart-emoji {
            cursor: pointer;
            font-size: 16px;
            margin-right: 8px;
        }
        .chart-emoji:hover {
            color: #007bff;
        }
        .dark-theme .chart-emoji:hover {
            color: #1a73e8;
        }
        .price-diff-box {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 16px;
            color: #333;
        }
        .dark-theme .price-diff-box {
            background: #2c2c2c;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            color: #e0e0e0;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            background: #fff;
        }
        .dark-theme .card {
            background: #2c2c2c;
        }
        .error-text {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
        }
        .price-unavailable {
            color: #dc3545;
            font-style: italic;
        }
        .calculator-buttons .btn {
            width: 100px;
            margin: 0 5px;
        }
        .calculator-buttons .btn.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .form-group label {
            color: #333;
        }
        .dark-theme .form-group label {
            color: #e0e0e0;
        }
        .form-control {
            background-color: #fff;
            color: #333;
            border: 2px solid #007bff;
            transition: border-color 0.3s;
        }
        .dark-theme .form-control {
            background-color: #333;
            color: #e0e0e0;
            border: 2px solid #007bff;
        }
        .form-control::placeholder {
            color: #6c757d;
        }
        .dark-theme .form-control::placeholder {
            color: #cccccc;
        }
        .form-control:focus {
            border-color: #0056b3;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease-in;
        }
        .dark-theme .results-table {
            background: #2c2c2c !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .results-table th, .results-table td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }
        .dark-theme .results-table th, .dark-theme .results-table td {
            border-bottom: 1px solid #444;
        }
        .results-table th {
            background-color: #007bff;
            color: white;
        }
        .results-table tr:last-child td {
            border-bottom: none;
        }
        .chart-iframe {
            width: 100%;
            height: 500px;
            border: none;
        }
        .amount-text {
            color: #333;
            font-size: 14px;
            margin-top: 5px;
        }
        .dark-theme .amount-text {
            color: #e0e0e0;
        }
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        .loading-spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #007bff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        .dark-theme .loading-spinner {
            border: 8px solid #444;
            border-top: 8px solid #1a73e8;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }
            .price-table, .card, .results-table {
                font-size: 14px;
            }
            .calculator-buttons .btn {
                width: 80px;
                margin: 0 3px;
            }
            .trade-column {
                width: 80px !important;
                min-width: 80px;
                max-width: 80px;
            }
            .trade-btn {
                width: 60px;
                padding: 3px 4px;
                font-size: 10px;
            }
            .chart-emoji {
                font-size: 14px;
                margin-right: 5px;
            }
            .price-diff-box {
                font-size: 14px;
                padding: 10px;
            }
            .chart-iframe {
                height: 300px;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-spinner"></div>
    </div>

    <div class="header">
        <h3 class="m-0">Ø§Ø±Ø¨ÛŒØªØ§Ø¬Ø±</h3>
        <button class="theme-toggle" id="theme-toggle">â˜€ï¸</button>
    </div>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                <h3>Ø¬Ø¯ÙˆÙ„ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</h3>
                <button class="btn btn-outline-primary mb-3" id="sort-price">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øª (Ù†Ø²ÙˆÙ„ÛŒ)</button>
                <table class="table table-bordered price-table" id="price-table">
                    <thead>
                        <tr>
                            <th>ØµØ±Ø§ÙÛŒ</th>
                            <th>Ù‚ÛŒÙ…Øª</th>
                            <th class="trade-column">Ù…Ø¹Ø§Ù…Ù„Ù‡</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr data-exchange="nobitex">
                            <td>Ù†ÙˆØ¨ÛŒØªÚ©Ø³</td>
                            <td id="nobitex-price" data-price="{{ nobitex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}">{{ nobitex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}</td>
                            <td class="trade-column">
                                <span class="chart-emoji" data-chart-url="https://app.bitycle.com/terminal?market=USDTIRT&source=nobitex_spot" data-exchange-name="Ù†ÙˆØ¨ÛŒØªÚ©Ø³">ğŸ“ˆ</span>
                                <a href="https://nobitex.ir/panel/exchange/usdt-irt/" class="trade-btn" target="_blank">Ù†ÙˆØ¨ÛŒØªÚ©Ø³</a>
                            </td>
                        </tr>
                        <tr data-exchange="bitpin">
                            <td>Ø¨ÛŒØª Ù¾ÛŒÙ†</td>
                            <td id="bitpin-price" data-price="{{ bitpin_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}">{{ bitpin_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}</td>
                            <td class="trade-column">
                                <a href="https://bitpin.ir/trade/USDT_IRT" class="trade-btn" target="_blank">Ø¨ÛŒØª Ù¾ÛŒÙ†</a>
                            </td>
                        </tr>
                        <tr data-exchange="ramzinex">
                            <td>Ø±Ù…Ø²ÛŒÙ†Ú©Ø³</td>
                            <td id="ramzinex-price" data-price="{{ ramzinex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}">{{ ramzinex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}</td>
                            <td class="trade-column">
                                <span class="chart-emoji" data-chart-url="https://app.bitycle.com/terminal?market=USDTIRT&source=ramzinex_spot" data-exchange-name="Ø±Ù…Ø²ÛŒÙ†Ú©Ø³">ğŸ“ˆ</span>
                                <a href="https://ramzinex.com/app/markets/11/spot" class="trade-btn" target="_blank">Ø±Ù…Ø²ÛŒÙ†Ú©Ø³</a>
                            </td>
                        </tr>
                        <tr data-exchange="tabdeal">
                            <td>ØªØ¨Ø¯ÛŒÙ„</td>
                            <td id="tabdeal-price" data-price="{{ tabdeal_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}">{{ tabdeal_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}</td>
                            <td class="trade-column">
                                <a href="https://tabdeal.org/panel/trade/USDT_IRT" class="trade-btn" target="_blank">ØªØ¨Ø¯ÛŒÙ„</a>
                            </td>
                        </tr>
                        <tr data-exchange="okex">
                            <td>Ø§ÙˆÚ©ÛŒ Ø§Ú©Ø³Ú†Ù†Ø¬</td>
                            <td id="okex-price" data-price="{{ okex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}">{{ okex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}</td>
                            <td class="trade-column">
                                <a href="https://ok-ex.io/buy-and-sell/USDT/" class="trade-btn" target="_blank">Ø§ÙˆÚ©ÛŒ Ø§Ú©Ø³Ú†Ù†Ø¬</a>
                            </td>
                        </tr>
                        <tr data-exchange="wallex">
                            <td>ÙˆØ§Ù„Ú©Ø³</td>
                            <td id="wallex-price" data-price="{{ wallex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}">{{ wallex_price or 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' }}</td>
                            <td class="trade-column">
                                <a href="https://wallex.ir/app/trade/USDTTMN?trade-type=margin&trade-history=margin" class="trade-btn" target="_blank">ÙˆØ§Ù„Ú©Ø³</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="price-diff-box" id="price-diff-box">
                    <p id="price-diff-text">Ø§Ø®ØªÙ„Ø§Ù Ù‚ÛŒÙ…Øª: Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-4">
                    <h3>Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</h3>
                    <div class="calculator-buttons mb-3">
                        <button class="btn btn-outline-primary active" id="usdt-btn">USDT</button>
                        <button class="btn btn-outline-primary" id="irt-btn">IRT</button>
                    </div>
                    <div class="form-group">
                        <label for="amount" id="amount-label">Ù…Ù‚Ø¯Ø§Ø± ØªØªØ±:</label>
                        <input type="number" class="form-control" id="amount" placeholder="Ù…Ù‚Ø¯Ø§Ø±">
                        <div id="amount-text" class="amount-text"></div>
                        <div id="amount-error" class="error-text"></div>
                    </div>
                    <button class="btn btn-primary mt-3" id="calculate-btn">Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                    <h4 class="mt-3">Ù†ØªØ§ÛŒØ¬</h4>
                    <div id="results"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ú†Ø§Ø±Øª -->
    <div class="modal fade" id="chartModal" tabindex="-1" aria-labelledby="chartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="chartModalLabel">Ú†Ø§Ø±Øª</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <iframe class="chart-iframe" id="chartIframe" src=""></iframe>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            themeToggle.textContent = document.body.classList.contains('dark-theme') ? 'â˜€ï¸' : 'ğŸŒ™';
        });

        // Cache management
        const CACHE_KEY = 'prices_cache';
        const CACHE_TTL = 5 * 60 * 1000; // 5 minutes in milliseconds

        function getCachedPrices() {
            const cached = localStorage.getItem(CACHE_KEY);
            if (cached) {
                const { data, timestamp } = JSON.parse(cached);
                if (Date.now() - timestamp < CACHE_TTL) {
                    return data;
                }
            }
            return null;
        }

        function setCachedPrices(data) {
            localStorage.setItem(CACHE_KEY, JSON.stringify({
                data,
                timestamp: Date.now()
            }));
        }

        // Sort prices
        let sortAscending = true;
        const sortButton = document.getElementById('sort-price');

        function updatePriceDiff() {
            const prices = [
                parseFloat(document.getElementById('nobitex-price').dataset.price),
                parseFloat(document.getElementById('bitpin-price').dataset.price),
                parseFloat(document.getElementById('ramzinex-price').dataset.price),
                parseFloat(document.getElementById('tabdeal-price').dataset.price),
                parseFloat(document.getElementById('okex-price').dataset.price),
                parseFloat(document.getElementById('wallex-price').dataset.price)
            ].filter(price => !isNaN(price) && price > 0);

            const diffBox = document.getElementById('price-diff-text');

            if (prices.length < 2) {
                diffBox.textContent = 'Ø§Ø®ØªÙ„Ø§Ù Ù‚ÛŒÙ…Øª: Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª';
                return;
            }

            const maxPrice = Math.max(...prices);
            const minPrice = Math.min(...prices);
            const diff = maxPrice - minPrice;
            const diffPercentage = ((diff / minPrice) * 100).toFixed(2);

            const formattedDiff = diff.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            diffBox.textContent = `Ø§Ø®ØªÙ„Ø§Ù Ù‚ÛŒÙ…Øª: ${formattedDiff} ØªÙˆÙ…Ø§Ù† (${diffPercentage}%)`;
        }

        function sortPrices() {
            const tableBody = document.getElementById('table-body');
            const rows = Array.from(tableBody.querySelectorAll('tr'));

            rows.sort((a, b) => {
                const priceA = parseFloat(a.querySelector('td:nth-child(2)').dataset.price) || -Infinity;
                const priceB = parseFloat(b.querySelector('td:nth-child(2)').dataset.price) || -Infinity;
                return sortAscending ? priceB - priceA : priceA - priceB;
            });

            sortAscending = !sortAscending;
            sortButton.textContent = sortAscending ? 'Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øª (Ù†Ø²ÙˆÙ„ÛŒ)' : 'Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù‚ÛŒÙ…Øª (ØµØ¹ÙˆØ¯ÛŒ)';
            tableBody.innerHTML = '';
            rows.forEach(row => tableBody.appendChild(row));

            updatePriceDiff();
        }

        sortButton.addEventListener('click', sortPrices);

        // Auto-sort on page load (descending)
        window.addEventListener('load', () => {
            sortAscending = true;
            sortPrices();
        });

        // Auto-update prices
        function updatePrices() {
            fetch('/api/prices')
                .then(response => response.json())
                .then(data => {
                    const exchanges = [
                        { id: 'nobitex', element: document.getElementById('nobitex-price') },
                        { id: 'bitpin', element: document.getElementById('bitpin-price') },
                        { id: 'ramzinex', element: document.getElementById('ramzinex-price') },
                        { id: 'tabdeal', element: document.getElementById('tabdeal-price') },
                        { id: 'okex', element: document.getElementById('okex-price') },
                        { id: 'wallex', element: document.getElementById('wallex-price') }
                    ];

                    exchanges.forEach(exchange => {
                        const price = data[exchange.id] || 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±';
                        exchange.element.textContent = price;
                        exchange.element.dataset.price = price !== 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' ? price.replace(/,/g, '') : 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±';
                    });

                    setCachedPrices(data);
                    sortAscending = true;
                    sortPrices();
                    updatePriceDiff();

                    // Hide loading screen after first successful load
                    const loadingScreen = document.getElementById('loading-screen');
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => loadingScreen.style.display = 'none', 500);
                })
                .catch(error => {
                    console.error('Error updating prices:', error);
                    document.getElementById('price-diff-text').textContent = 'Ø§Ø®ØªÙ„Ø§Ù Ù‚ÛŒÙ…Øª: Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ';
                });
        }

        // Load cached prices on page load
        window.addEventListener('load', () => {
            const cachedPrices = getCachedPrices();
            if (cachedPrices) {
                const exchanges = [
                    { id: 'nobitex', element: document.getElementById('nobitex-price') },
                    { id: 'bitpin', element: document.getElementById('bitpin-price') },
                    { id: 'ramzinex', element: document.getElementById('ramzinex-price') },
                    { id: 'tabdeal', element: document.getElementById('tabdeal-price') },
                    { id: 'okex', element: document.getElementById('okex-price') },
                    { id: 'wallex', element: document.getElementById('wallex-price') }
                ];

                exchanges.forEach(exchange => {
                    const price = cachedPrices[exchange.id] || 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±';
                    exchange.element.textContent = price;
                    exchange.element.dataset.price = price !== 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±' ? price.replace(/,/g, '') : 'Ù†Ø§Ù…Ø¹ØªØ¨Ø±';
                });

                sortAscending = true;
                sortPrices();
                updatePriceDiff();
            }

            updatePrices(); // Fetch fresh prices
        });

        // Update prices every 50 seconds
        setInterval(updatePrices, 50000);

        // Chart modal logic
        const chartModalElement = document.getElementById('chartModal');
        const chartModal = new bootstrap.Modal(chartModalElement);
        const chartIframe = document.getElementById('chartIframe');
        const chartModalLabel = document.getElementById('chartModalLabel');
        const chartEmojis = document.querySelectorAll('.chart-emoji');

        chartEmojis.forEach(emoji => {
            emoji.addEventListener('click', () => {
                const chartUrl = emoji.getAttribute('data-chart-url');
                const exchangeName = emoji.getAttribute('data-exchange-name');
                chartIframe.src = chartUrl;
                chartModalLabel.textContent = `Ú†Ø§Ø±Øª ${exchangeName}`;
                chartModal.show();
            });
        });

        // Calculator logic
        let calculationMode = 'usdt';

        function formatNumber(number) {
            const parts = number.toString().split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            return parts.join('.');
        }

        // Convert number to Persian words
        function numberToPersianWords(number) {
            const units = ['', 'Ù‡Ø²Ø§Ø±', 'Ù…ÛŒÙ„ÛŒÙˆÙ†', 'Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯', 'ØªØ±ÛŒÙ„ÛŒÙˆÙ†'];
            const numbers = [
                '', 'ÛŒÚ©', 'Ø¯Ùˆ', 'Ø³Ù‡', 'Ú†Ù‡Ø§Ø±', 'Ù¾Ù†Ø¬', 'Ø´Ø´', 'Ù‡ÙØª', 'Ù‡Ø´Øª', 'Ù†Ù‡',
                'Ø¯Ù‡', 'ÛŒØ§Ø²Ø¯Ù‡', 'Ø¯ÙˆØ§Ø²Ø¯Ù‡', 'Ø³ÛŒØ²Ø¯Ù‡', 'Ú†Ù‡Ø§Ø±Ø¯Ù‡', 'Ù¾Ø§Ù†Ø²Ø¯Ù‡', 'Ø´Ø§Ù†Ø²Ø¯Ù‡', 'Ù‡ÙØ¯Ù‡', 'Ù‡Ø¬Ø¯Ù‡', 'Ù†ÙˆØ²Ø¯Ù‡'
            ];
            const tens = ['', '', 'Ø¨ÛŒØ³Øª', 'Ø³ÛŒ', 'Ú†Ù‡Ù„', 'Ù¾Ù†Ø¬Ø§Ù‡', 'Ø´ØµØª', 'Ù‡ÙØªØ§Ø¯', 'Ù‡Ø´ØªØ§Ø¯', 'Ù†ÙˆØ¯'];
            const hundreds = ['', 'ØµØ¯', 'Ø¯ÙˆÛŒØ³Øª', 'Ø³ÛŒØµØ¯', 'Ú†Ù‡Ø§Ø±ØµØ¯', 'Ù¾Ø§Ù†ØµØ¯', 'Ø´Ø´ØµØ¯', 'Ù‡ÙØªØµØ¯', 'Ù‡Ø´ØªØµØ¯', 'Ù†Ù‡ØµØ¯'];

            if (number === 0) return 'ØµÙØ±';

            let result = '';
            let unitIndex = 0;

            while (number > 0) {
                let chunk = number % 1000;
                if (chunk > 0) {
                    let chunkText = '';
                    let hundred = Math.floor(chunk / 100);
                    chunk %= 100;
                    let ten = Math.floor(chunk / 10);
                    let one = chunk % 10;

                    if (hundred > 0) {
                        chunkText += hundreds[hundred];
                        if (ten > 0 || one > 0) chunkText += ' Ùˆ ';
                    }

                    if (ten === 1) {
                        chunkText += numbers[10 + one];
                    } else {
                        if (ten > 1) {
                            chunkText += tens[ten];
                            if (one > 0) chunkText += ' Ùˆ ';
                        }
                        if (one > 0 && ten !== 1) {
                            chunkText += numbers[one];
                        }
                    }

                    if (unitIndex > 0 && chunkText) {
                        chunkText += ' ' + units[unitIndex];
                    }

                    if (result && chunkText) {
                        result = chunkText + ' Ùˆ ' + result;
                    } else {
                        result = chunkText + result;
                    }
                }
                number = Math.floor(number / 1000);
                unitIndex++;
            }

            return result;
        }

        function updateAmountText() {
            const amountInput = document.getElementById('amount');
            const amountText = document.getElementById('amount-text');
            const amount = parseInt(amountInput.value);

            if (amount > 0 && !isNaN(amount)) {
                if (calculationMode === 'irt') {
                    amountText.textContent = `${numberToPersianWords(amount)} ØªÙˆÙ…Ø§Ù†`;
                } else {
                    amountText.textContent = `${numberToPersianWords(amount)} ØªØªØ±`;
                }
            } else {
                amountText.textContent = '';
            }
        }

        function setCalculationMode(mode) {
            calculationMode = mode;
            const usdtBtn = document.getElementById('usdt-btn');
            const irtBtn = document.getElementById('irt-btn');
            const amountLabel = document.getElementById('amount-label');
            const amountInput = document.getElementById('amount');

            if (mode === 'usdt') {
                usdtBtn.classList.add('active');
                irtBtn.classList.remove('active');
                amountLabel.textContent = 'Ù…Ù‚Ø¯Ø§Ø± ØªØªØ±:';
                amountInput.placeholder = 'Ù…Ù‚Ø¯Ø§Ø± ØªØªØ±';
            } else {
                irtBtn.classList.add('active');
                usdtBtn.classList.remove('active');
                amountLabel.textContent = 'Ù…Ù‚Ø¯Ø§Ø± ØªÙˆÙ…Ø§Ù†:';
                amountInput.placeholder = 'Ù…Ù‚Ø¯Ø§Ø± ØªÙˆÙ…Ø§Ù†';
            }

            amountInput.value = '';
            document.getElementById('amount-error').textContent = '';
            document.getElementById('amount-text').textContent = '';
            document.getElementById('results').innerHTML = '';
            updateAmountText();
        }

        function validateInput(amount, errorElement) {
            errorElement.textContent = '';
            if (!amount || isNaN(amount) || amount <= 0) {
                errorElement.textContent = 'Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯';
                return false;
            }
            return true;
        }

        function calculate() {
            const amount = parseFloat(document.getElementById('amount').value);
            const amountError = document.getElementById('amount-error');
            const resultsElement = document.getElementById('results');

            resultsElement.innerHTML = '';

            if (!validateInput(amount, amountError)) {
                return;
            }

            const exchanges = [
                { id: 'nobitex', name: 'Ù†ÙˆØ¨ÛŒØªÚ©Ø³' },
                { id: 'bitpin', name: 'Ø¨ÛŒØª Ù¾ÛŒÙ†' },
                { id: 'ramzinex', name: 'Ø±Ù…Ø²ÛŒÙ†Ú©Ø³' },
                { id: 'tabdeal', name: 'ØªØ¨Ø¯ÛŒÙ„' },
                { id: 'okex', name: 'Ø§ÙˆÚ©ÛŒ Ø§Ú©Ø³Ú†Ù†Ø¬' },
                { id: 'wallex', name: 'ÙˆØ§Ù„Ú©Ø³' }
            ];

            let results = '<table class="results-table"><thead><tr><th>ØµØ±Ø§ÙÛŒ</th><th>Ù…Ù‚Ø¯Ø§Ø±</th></tr></thead><tbody>';
            let hasValidResult = false;

            exchanges.forEach(exchange => {
                const priceElement = document.getElementById(exchange.id + '-price');
                const price = parseFloat(priceElement.dataset.price);

                if (!isNaN(price) && price > 0) {
                    let resultValue;
                    if (calculationMode === 'usdt') {
                        resultValue = (amount * price).toFixed(2);
                        resultValue = formatNumber(resultValue);
                        resultValue = `${resultValue} ØªÙˆÙ…Ø§Ù†`;
                    } else {
                        resultValue = (amount / price).toFixed(6);
                        resultValue = formatNumber(resultValue);
                        resultValue = `${resultValue} ØªØªØ±`;
                    }
                    results += `<tr><td>${exchange.name}</td><td>${resultValue}</td></tr>`;
                    hasValidResult = true;
                }
            });

            results += '</tbody></table>';

            resultsElement.innerHTML = hasValidResult ? results : "<p class='error-text'>Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª</p>";
        }

        // Calculator event listeners
        document.getElementById('usdt-btn').addEventListener('click', () => setCalculationMode('usdt'));
        document.getElementById('irt-btn').addEventListener('click', () => setCalculationMode('irt'));
        document.getElementById('calculate-btn').addEventListener('click', calculate);
        document.getElementById('amount').addEventListener('input', updateAmountText);
    </script>
</body>
</html>